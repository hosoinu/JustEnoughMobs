<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Found Mobs - Minecraft Mob Catalogue</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/gif" href="https://media.tenor.com/glcPxQrM51EAAAAi/minecraft.gif"/>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Aldrich&family=Bungee+Spice&family=Jacquard+24&family=Jersey+15&family=Press+Start+2P&display=swap" rel="stylesheet"/>
  
  <style>
    /* ===== BASE STYLES ===== */
    body {
      margin: 0;
      padding: 0;
      background-color: #1a1a1a;
      font-family: Arial, sans-serif;
      color: #fff;
      background-image: url('https://wallpaperaccess.com/full/6104111.png');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ===== NAVIGATION BAR ===== */
    #nav-bar {
        background-image: url(https://wallpapercave.com/wp/wp8643134.jpg);
        background-size: cover;
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 1000;
        height: 60px;
    }

    #nav-bar img {
        height: 40px;
        cursor: pointer;
        transition: transform 0.3s ease;
    }

    #nav-bar img:hover {
        transform: scale(1.2);
    }

    #nav-buttons {
        display: flex;
        gap: 15px;
    }

    /* Navigation buttons styling */
    #nav-buttons button {
        font-family: 'Press Start 2P', cursive;
        background-image: url('https://art.pixilart.com/sr2ff82b7a8f295.png');
        background-size: cover;
        background-position: center;
        color: white;
        border: none;
        padding: 12px 24px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    #nav-buttons button:hover {
        color: #d0cfcf;
        text-shadow: 
            -1px -1px 0 #2c1b0e, 
            1px -1px 0 #2c1b0e, 
            -1px 1px 0 #2c1b0e, 
            1px 1px 0 #2c1b0e;
        transform: translateY(-2px);
    }

    /* ===== LOGIN SYSTEM ===== */
    #login-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        backdrop-filter: blur(5px);
        background-color: rgba(0, 0, 0, 0.4);
        z-index: 999;
    }

    .login-dialog {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(0, 0, 0, 0.85);
        padding: 30px;
        border-radius: 10px;
        border: 3px solid #26da19;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
        width: 350px;
        z-index: 1000;
    }

    .login-dialog h2 {
        font-family: 'Press Start 2P', cursive;
        color: #26da19;
        text-align: center;
        margin-bottom: 25px;
        font-size: 18px;
        text-shadow: 0 0 5px #26da19;
    }

    .login-dialog label {
        display: block;
        margin-bottom: 5px;
        font-family: 'Aldrich', sans-serif;
        color: #26da19;
        font-size: 14px;
    }

    .login-dialog input {
        width: 100%;
        padding: 8px;
        margin-bottom: 15px;
        background-color: #333;
        border: 1px solid #26da19;
        color: white;
        font-family: 'Aldrich', sans-serif;
    }

    .login-dialog button {
        width: 100%;
        padding: 10px;
        background-color: #26da19;
        color: black;
        border: none;
        border-radius: 3px;
        font-family: 'Press Start 2P', cursive;
        font-size: 12px;
        cursor: pointer;
    }

    .login-dialog button:hover {
        background-color: #1eb812;
    }

    .close-login {
        position: absolute;
        top: 10px;
        right: 10px;
        color: red;
        cursor: pointer;
        font-size: 18px;
    }

    /* Login button styling */
    #login-btn {
        background-image: url('https://art.pixilart.com/sr2ff82b7a8f295.png');
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
        color: white;
        border: none;
        padding: 12px 24px;
        font-size: 16px;
        cursor: pointer;
        font-family: 'Press Start 2P', cursive;
    }

    #login-btn:hover {
        color: #d0cfcf;
        text-shadow: 
            -1px -1px 0 #2c1b0e, 
            1px -1px 0 #2c1b0e, 
            -1px 1px 0 #2c1b0e, 
            1px 1px 0 #2c1b0e;
        transform: translateY(-2px);
    }

    .login-link {
        text-align: center;
        margin-top: 15px;
        font-family: 'Aldrich', sans-serif;
        font-size: 12px;
        color: #26da19;
    }

    .login-link a {
        color: #26da19;
        text-decoration: none;
    }

    .login-link a:hover {
        text-decoration: underline;
    }

    /* ===== GENERAL ELEMENTS ===== */
    /* Remove default button styles */
    button {
        background: none;
        margin: 0;
        padding: 0;
        border: none;
        font: inherit;
        cursor: pointer;
        outline: inherit;
    }

    a {
        text-decoration: none;
        color: white;
    }

    /* ===== SEARCH SYSTEM ===== */
    .search-container {
        display: flex;
        align-items: center;
    }

    /* Search input styles */
    .search-input {
        width: 300px;
        padding: 10px;
        border-radius: 5px;
        background-color: #f8f8f1;
        border: 2px solid #000000;
        margin: 0;
        margin-right: 10px;
        box-sizing: border-box;
        cursor: text;
        font-family: 'Press Start 2P', cursive;
    }

    .search-input:hover {
        background-color: #e5e2e2; 
        opacity: 0.8; 
    }

    .search-button {
        background-image: url('https://art.pixilart.com/sr2ff82b7a8f295.png');
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
        color: rgb(255, 255, 255);
        border: transparent;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-family: 'Press Start 2P', cursive;
        font-size: 14px;
    }

    .search-button:hover {
        filter: brightness(0.9);
    }

    /* ===== MAIN CONTENT ===== */
    .container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 15px;
        width: calc(100% - 360px);
        margin: 30px auto 0 auto; 
        padding: 0 20px;
        box-sizing: border-box;
        min-height: calc(100vh - 100px);
        align-content: start;
    }

    /* ===== MOB CARDS ===== */
    #mob-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 15px;
        width: 100%;
        padding: 0 10px;
        box-sizing: border-box;
    }

    .mob-card {
        background: rgba(0, 0, 0, 0.7);
        border: 2px solid #4CAF50;
        border-radius: 8px;
        text-align: center;
        padding: 8px;
        transition: transform 0.2s ease;
        cursor: pointer;
        box-shadow: 0 0 10px #4CAF50;
    }

    .mob-card img {
        width: 80px;
        height: 80px;
        object-fit: contain;
    }

    .mob-card p {
        margin: 8px 0 0;
        font-size: 14px;
    }

    .mob-card:hover {
        transform: scale(1.05);
    }

    .found-count, .slain-count {
        font-family: 'Press Start 2P', cursive;
        font-size: 12px;
        margin-left: 5px;
        color: #26da19;
    }

    /* ===== MOB DETAIL PANEL ===== */
    .mob-detail {
        position: fixed;
        left: 10px;
        top: 100px;
        width: 320px;
        height: calc(100vh - 170px);
        background: rgba(34, 34, 34, 0.95);
        color: white;
        padding: 20px;
        overflow-y: auto;
        border: 3px solid #26da19;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,0,0,0.8);
        display: none;
        z-index: 1001;
    }

    .mob-detail h2 {
        font-family: 'Press Start 2P', cursive;
        color: #26da19;
        margin: 0 0 20px 0;
        text-align: center;
        font-size: 16px;
    }

    .mob-detail img {
        width: 180px;
        height: 180px;
        object-fit: contain;
        display: block;
        margin: 0 auto 25px;
        border: 2px solid #26da19;
        border-radius: 5px;
        background: rgba(0,0,0,0.5);
    }

    .divider {
        height: 1px;
        background-color: #26da19;
        margin: 0 0 20px 0;
        opacity: 0.3;
    }

    .mob-description-label {
        font-family: 'Press Start 2P', cursive;
        color: #26da19;
        margin: 0 0 10px 0;
        font-size: 12px;
        text-align: center;
    }

    .mob-description-text {
        font-family: 'Aldrich', sans-serif;
        line-height: 1.5;
        font-size: 14px;
        background: rgba(0,0,0,0.3);
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 25px;
    }

    .mob-actions {
        display: flex;
        justify-content: space-around;
        margin-top: 20px;
    }

    .mob-action-btn {
        background: transparent;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 5px;
        margin: 0 5px;
    }

    .mob-action-btn:hover {
        transform: scale(1.1);
    }

    #found-toggle {
        border-color: #4CAF50;
    }

    #slain-toggle {
        border-color: #F44336;
    }

    .mob-action-btn img {
        width: 40px;
        height: 40px;
        border: none;
        background: transparent;
    }

    .mob-action-label {
        font-family: 'Press Start 2P', cursive;
        font-size: 9px;
        margin-top: 5px;
        color: #26da19;
    }

    .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 18px;
        cursor: pointer;
        color: red;
        background: rgba(0,0,0,0.5);
        border-radius: 50%;
        width: 25px;
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* ===== PAGE TITLE ===== */
    .page-title {
        font-family: 'Press Start 2P', cursive;
        color: #4CAF50;
        text-align: center;
        margin: 20px 0;
        font-size: 24px;
        text-shadow: 0 0 5px #4CAF50;
    }
  </style>
</head>

<body>
  <!-- Navigation bar -->
  <nav id="nav-bar">
    <div id="nav-div" onclick="window.location.href='index.html'">
      <img src="https://preview.redd.it/did-you-know-that-you-can-change-the-icon-file-for-shortcuts-v0-u0apg1gpnz4b1.png?width=256&format=png&auto=webp&s=5658e7ebe291e3cff7c67d44a03009172879cfbb" alt="Minecraft Icon">
    </div>

    <!-- Navigation buttons -->
    <div id="nav-buttons">
      <div class="accordion">
          <button><a href="index.html">Mobs</a></button>
      </div>
  
      <button id="found-btn">
          <a href="found.html">Found</a> <span class="found-count">0</span>
      </button>
      <button id="slain-btn">
          <a href="slain.html">Slain</a> <span class="slain-count">0</span>
      </button>
    </div>
    
    <!-- Search section -->
    <div class="search-container">
      <input id="search-key" type="text" class="search-input" placeholder="Search mobs...">
      <button class="search-button" onclick="search()">Search</button>
      <button class="clear-search-button" onclick="clearSearch()" style="display: none;">✕</button>
    </div>

    <button id="login-btn">Login</button>
  </nav>

  <!-- Page title -->
  <h1 class="page-title">FOUND MOBS</h1>

  <!-- Main content container for mobs -->
  <div class="container" id="mob-container">
    <!-- Mob cards will be dynamically inserted here -->
  </div>

  <!-- Mob detail panel -->
  <div id="mob-detail-panel" class="mob-detail">
    <span class="close-btn" onclick="closeMobDetail()">X</span>
    <h2 id="mob-name"></h2>
    <img id="mob-image" src="" alt="Mob Image" />
    <div class="divider"></div>
    <div class="mob-description-label">MOB DESCRIPTION</div>
    <div id="mob-description" class="mob-description-text"></div>
    <div class="mob-actions">
      <button id="found-toggle" class="mob-action-btn" title="Toggle Found">
        <img src="https://wiki.chisels-and-bits.com/assets/images/items/chiselsandbits/magnifying_glass.png" alt="Found">
        <span class="mob-action-label" id="found-label">UNMARK FOUND</span>
      </button>
      <button id="slain-toggle" class="mob-action-btn" title="Toggle Slain">
        <img src="https://static.wikia.nocookie.net/minecraft_gamepedia/images/4/44/Diamond_Sword_JE3_BE3.png" alt="Slain">
        <span class="mob-action-label" id="slain-label">MARK SLAIN</span>
      </button>
    </div>
  </div>

  <!-- Login Dialog -->
  <div id="login-overlay" style="display: none;"></div>
  <div id="login-dialog" class="login-dialog">
    <span class="close-login" onclick="closeLogin()">✕</span>
    <h2>MINECRAFT LOGIN</h2>
    <form id="login-form">
      <label for="login-username">USERNAME OR EMAIL:</label>
      <input type="text" id="login-username" required>
      
      <label for="login-password">PASSWORD:</label>
      <input type="password" id="login-password" required>
      
      <button type="submit">LOGIN</button>

      <div class="login-link">
        Don't have an account? <a href="signup.html">Sign Up</a>
      </div>
    </form>
  </div>

  <!-- Add Firebase scripts at bottom before closing </body> -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";
  import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";
  import { arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA8JLGsugNvlMso3VEoFdOUMCIdqKiF9XQ",
    authDomain: "justenoughmobs.firebaseapp.com",
    projectId: "justenoughmobs",
    storageBucket: "justenoughmobs.firebasestorage.app",
    messagingSenderId: "644805110590",
    appId: "1:644805110590:web:f5b97212c0fbaf4e605a6f",
    measurementId: "G-7Q7BRL80XQ"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Global variables
  let allMobs = [];
  let foundMobs = [];
  let slainMobs = [];
  let currentUser = null;

  // Auth state listener
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      currentUser = user;
      document.getElementById('login-btn').textContent = 'Logout';
      await loadUserData();
      init();
    } else {
      window.location.href = 'index.html';
    }
  });

  async function loadUserData() {
    const userDocRef = doc(db, "users", currentUser.uid);
    const userDoc = await getDoc(userDocRef);
    
    if (userDoc.exists()) {
      const data = userDoc.data();
      foundMobs = data.foundMobs || [];
      slainMobs = data.slainMobs || []; 
    }
  }

  async function init() {
  try {
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        document.getElementById('login-btn').textContent = 'Logout';

        // Load user data from Firestore
        const userDocRef = doc(db, "users", user.uid);
        const userDoc = await getDoc(userDocRef);
        
        if (userDoc.exists()) {
          const userData = userDoc.data();
          foundMobs = userData.foundMobs || [];
          slainMobs = userData.slainMobs || [];
        }

        // Load mob data
        const response = await fetch('https://hosoinu.github.io/entities.json');
        allMobs = await response.json();
        
        // Render based on current page
        if (window.location.pathname.includes('found.html')) {
          renderFoundMobs();
        } else {
          renderSlainMobs();
        }
        updateCounters();
      } else {
        alert('Please login to view this page!');
        window.location.href = 'index.html';
      }
    });
  } catch (error) {
    console.error("Error initializing:", error);
  }
}

  async function markMob(mobName, type) {
  if (!currentUser) {
    alert('Please login to mark mobs!');
    return;
  }

  try {
    const userDocRef = doc(db, "users", currentUser.uid);
    
    if (type === 'found') {
      const operation = foundMobs.includes(mobName) ? 'remove' : 'add';
      await updateDoc(userDocRef, {
        foundMobs: operation === 'remove' ? 
          arrayRemove(mobName) : arrayUnion(mobName)
      });
    } 
    else if (type === 'slain') {
      const operation = slainMobs.includes(mobName) ? 'remove' : 'add';
      await updateDoc(userDocRef, {
        slainMobs: operation === 'remove' ? 
          arrayRemove(mobName) : arrayUnion(mobName)
      });
    }

    // Refresh data after update
    const userDoc = await getDoc(userDocRef);
    const userData = userDoc.data();
    foundMobs = userData.foundMobs || [];
    slainMobs = userData.slainMobs || [];

    if (window.location.pathname.includes('found.html')) {
      renderFoundMobs();
    } else {
      renderSlainMobs();
    }
    updateCounters();
    updateMobDetailButtons(mobName);

  } catch (error) {
    console.error("Error updating mob status:", error);
    alert("Error saving changes. Please try again.");
  }
}

  // Update login handler
  document.getElementById('login-btn').addEventListener('click', async () => {
    if (currentUser) {
      await signOut(auth);
      window.location.href = 'index.html';
    }
  });

  // Update login form submission
  document.getElementById('login-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('login-username').value;
    const password = document.getElementById('login-password').value;

    try {
      await signInWithEmailAndPassword(auth, email, password);
      closeLogin();
    } catch (error) {
      alert(`Login failed: ${error.message}`);
    }
  });

  // Keep the rest of your rendering and UI functions the same
  // (renderFoundMobs, updateCounters, search, etc.)


    
    // Render only found mobs
    function renderFoundMobs() {
  const container = document.getElementById('mob-container');
  container.innerHTML = '';

  if (!allMobs || allMobs.length === 0) {
    container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; font-family: \'Press Start 2P\', cursive; color: #26da19;">No mobs available!</p>';
    return;
  }

  const foundMobsData = allMobs.filter(mob => foundMobs.includes(mob.name));

  if (foundMobsData.length === 0) {
    container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; font-family: \'Press Start 2P\', cursive; color: #26da19;">No mobs found yet!</p>';
    return;
  }

  foundMobsData.forEach(function (mob) {
    const mobCard = document.createElement('div');
    mobCard.classList.add('mob-card');
    mobCard.innerHTML = `
      <img src="${mob.icon || 'fallback.png'}" alt="${mob.name}" />
      <p>${mob.name}</p>
    `;
    mobCard.onclick = function () {
      showMobDetail(mob);
    };
    container.appendChild(mobCard);
  });
}

    // Mark or unmark a mob as found/slain
    function markMob(mobName, type) {
      if (!currentUser) {
        alert('Please login to mark mobs!');
        return;
      }

      if (type === 'found') {
        const index = foundMobs.indexOf(mobName);
        if (index !== -1) {
          foundMobs.splice(index, 1); // Unmark
        } else {
          foundMobs.push(mobName); // Mark
        }
      } else if (type === 'slain') {
        const index = slainMobs.indexOf(mobName);
        if (index !== -1) {
          slainMobs.splice(index, 1); // Unmark
        } else {
          slainMobs.push(mobName); // Mark
        }
      }

      saveUserData();
      renderFoundMobs();
      updateCounters();
    }

    // Save user data to localStorage
    function saveUserData() {
      if (currentUser) {
        const userData = {
          foundMobs: foundMobs,
          slainMobs: slainMobs
        };
        localStorage.setItem(`userData_${currentUser.username}`, JSON.stringify(userData));
      }
    }

    // Update the found/slain buttons in detail panel
    function updateMobDetailButtons(mobName) {
      const foundLabel = document.getElementById('found-label');
      const slainLabel = document.getElementById('slain-label');
      
      // Update found button
      if (foundMobs.includes(mobName)) {
        foundLabel.textContent = 'UNMARK FOUND';
        document.getElementById('found-toggle').style.borderColor = '#4CAF50';
      } else {
        foundLabel.textContent = 'MARK FOUND';
        document.getElementById('found-toggle').style.borderColor = '#26da19';
      }
      
      // Update slain button
      if (slainMobs.includes(mobName)) {
        slainLabel.textContent = 'UNMARK SLAIN';
        document.getElementById('slain-toggle').style.borderColor = '#F44336';
      } else {
        slainLabel.textContent = 'MARK SLAIN';
        document.getElementById('slain-toggle').style.borderColor = '#26da19';
      }
    }

    // Show detailed view for a mob
    function showMobDetail(mob) {
      document.getElementById('mob-image').src = mob.icon || 'fallback.png';
      document.getElementById('mob-name').textContent = mob.name;
      document.getElementById('mob-description').textContent = mob.description || "No description available.";
      document.getElementById('mob-detail-panel').style.display = 'block';
      updateMobDetailButtons(mob.name);
    }

    // Close the mob detail panel
    function closeMobDetail() {
      document.getElementById('mob-detail-panel').style.display = 'none';
    }

    // Update the found/slain counters
    function updateCounters() {
      document.querySelector('.found-count').textContent = foundMobs.length;
      document.querySelector('.slain-count').textContent = slainMobs.length;
    }

    // Search function
    function search() {
      const searchTerm = document.getElementById('search-key').value.toLowerCase();
      
      if (searchTerm.trim() !== '') {
        // Filter mobs if search term exists
        const filteredMobs = allMobs.filter(function(mob) {
          return mob.name.toLowerCase().includes(searchTerm) && foundMobs.includes(mob.name);
        });
        renderFilteredMobs(filteredMobs);
      } else {
        // Show all found mobs if search is empty
        renderFoundMobs();
      }
    }

    // Render filtered mobs
    function renderFoundMobs() {
  const container = document.getElementById('mob-container');
  container.innerHTML = '';
  
  const filteredMobs = allMobs.filter(mob => 
    foundMobs.includes(mob.name) && 
    mob.category // Add any additional filtering needed
  );
  
  if (filteredMobs.length === 0) {
    container.innerHTML = '<p style="...">No found mobs yet!</p>';
    return;
  }

      mobs.forEach(function(mob) {
        const mobCard = document.createElement('div');
        mobCard.classList.add('mob-card');
        mobCard.innerHTML = `
          <img src="${mob.icon || 'fallback.png'}" alt="${mob.name}" />
          <p>${mob.name}</p>
        `;
        mobCard.onclick = function() {
          showMobDetail(mob);
        };
        container.appendChild(mobCard);
      });
    }

    // Clear search and show all found mobs
    function clearSearch() {
      document.getElementById('search-key').value = '';
      renderFoundMobs();
    }

    // Login functionality
    const loginBtn = document.getElementById('login-btn');
    const loginDialog = document.getElementById('login-dialog');
    const loginForm = document.getElementById('login-form');

    // Handle login button click
    loginBtn.addEventListener('click', function() {
      if (currentUser) {
        // User is logged in - offer logout
        const confirmLogout = confirm(`Sign out ${currentUser.username}?`);
        if (confirmLogout) {
          // Logout user
          localStorage.removeItem('currentUser');
          currentUser = null;
          foundMobs = [];
          slainMobs = [];
          loginBtn.textContent = 'Login';
          alert('Signed out successfully!');
          window.location.href = 'index.html';
        }
      } else {
        // Show login dialog
        document.getElementById('login-overlay').style.display = 'block';
        loginDialog.style.display = 'block';
      }
    });

    // Close login dialog
    function closeLogin() {
      loginDialog.style.display = 'none';
      document.getElementById('login-overlay').style.display = 'none';
    }

    // Handle login form submission
    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();

      const usernameInput = document.getElementById('login-username').value.trim();
      const passwordInput = document.getElementById('login-password').value;

      const users = JSON.parse(localStorage.getItem('users')) || [];

      // Find matching user
      let foundUser = null;
      for (let i = 0; i < users.length; i++) {
        const user = users[i];
        if ((user.username === usernameInput || user.email === usernameInput) &&
            user.password === passwordInput) {
          foundUser = user;
          break;
        }
      }

      if (!foundUser) {
        alert('Invalid username/email or password!');
        return;
      }

      // Login successful
      currentUser = foundUser;
      localStorage.setItem('currentUser', JSON.stringify(currentUser));

      // Load user data
      const userData = JSON.parse(localStorage.getItem(`userData_${currentUser.username}`)) || {};
      foundMobs = userData.foundMobs || [];
      slainMobs = userData.slainMobs || [];

      // Update UI
      loginBtn.textContent = 'Logout';
      alert(`Welcome, ${currentUser.username}!`);
      closeLogin();
      renderFoundMobs();
    });

    // Close dialog when clicking outside
    window.addEventListener('click', function(e) {
      if (e.target === document.getElementById('login-overlay')) {
        closeLogin();
      }
    });

    // Handle Enter key in search
    document.getElementById('search-key').addEventListener('keyup', function(e) {
      if (e.key === 'Enter') {
        search();
      }
    });

    // Show/hide clear search button
    document.getElementById('search-key').addEventListener('input', function() {
      const clearBtn = document.querySelector('.clear-search-button');
      if (this.value) {
        clearBtn.style.display = 'block';
      } else {
        clearBtn.style.display = 'none';
      }
    });

    // Add click handlers for mob action buttons
    document.getElementById('found-toggle').addEventListener('click', function() {
      const mobName = document.getElementById('mob-name').textContent;
      markMob(mobName, 'found');
      updateMobDetailButtons(mobName);
    });

    document.getElementById('slain-toggle').addEventListener('click', function() {
      const mobName = document.getElementById('mob-name').textContent;
      markMob(mobName, 'slain');
      updateMobDetailButtons(mobName);
    });

    // Initialize the app when page loads
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>